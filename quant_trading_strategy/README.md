# Quant Trading Strategy

這是我的量化交易專案，放置回測與策略程式。

---

## NQ Futures Quantitative Trading Strategy

本專案基於美國納斯達克期貨（NQ Futures），使用 Python 進行量化交易回測與策略優化。  
使用套件：`pandas`、`yfinance`、`matplotlib` 與 `Optuna`。  

主要功能：
- 簡單均線與 MACD 趨勢交易策略
- 可動態調整停損與下單口數
- 回測績效計算：盈虧比、最大回撤、夏普比率
- Optuna 自動化參數優化
- 資金保護設定：初始資金 50,000 美金
- 動態 MML 設定：初始可虧 -2,000 美金，最高 50,000 美金

---

## 功能說明

### 1️⃣ 策略邏輯

**進場條件**
- MACD 為負值
- 股價突破短期或長期均線
- 近期股價呈現上升趨勢
- 整體趨勢多頭（股價高於長期均線）

**出場條件**
- 達到停損（以 USD 計算）
- 短期均線跌破長期均線

**下單口數**
- 依風險管理計算每筆交易可下單口數
- 最大口數可自訂

---

### 2️⃣ 績效指標
- 總交易次數
- 勝率
- 最大單筆虧損
- 最大回撤
- 盈虧比（Profit/Loss Ratio）
- 夏普比率（Sharpe Ratio）

---

### 3️⃣ 參數優化
使用 Optuna 自動尋找最佳：
- 短期均線週期 (`ma_short`)
- 長期均線週期 (`ma_long`)
- 停損 USD (`stop_loss_usd`)
- 最大下單口數 (`max_lots`)
  
---

## 專案結構

quant_trading_strategy/
│
├── README.md
├── requirements.txt
├── backtest.py
├── optimize.py
├── utils.py
├── data/
└── plots/

---

## 安裝方法

```bash
git clone https://github.com/dingx9/quant_trading_strategy.git
cd quant_trading_strategy
pip install -r requirements.txt

```

注意事項

策略為歷史回測範例，未包含手續費與滑價，僅作學習與展示用途。
歷史資料採用 yfinance 下載，資料品質與完整性可能影響回測結果。
投資有風險，請勿直接套用於實盤交易。


範例回測結果
初始資金: 50000.00 美金
總交易次數: 11
總盈利: 27420.00 美金
總虧損: 8120.00 美金
勝率: 54.55%
最大單筆虧損: -2680.00 美金
最大回撤: 15160.00 (30.32%)
最後資金總額: 69300.00 美金
盈虧比: 3.38
夏普比率: 1.91

<details> <summary>點擊展開每筆交易明細</summary>
進場時間	出場時間	買賣	價格 (進/出)	口數	盈虧 (USD)	盈虧 (%)	持倉時間
2025-08-27 01:05	2025-08-27 06:40	買/賣	23607 / 23615.25	4	660	0.03%	0 days 05:35:00
2025-08-28 11:50	2025-08-29 01:50	買/賣	23610.75 / 23732.25	4	9720	0.51%	0 days 14:00:00
2025-09-03 04:05	2025-09-03 17:35	買/賣	23325.75 / 23404.50	4	6300	0.34%	0 days 13:30:00
2025-09-04 04:10	2025-09-04 06:55	買/賣	23487.50 / 23454.00	4	-2680	-0.14%	0 days 02:45:00
2025-09-08 03:05	2025-09-08 04:40	買/賣	23759 / 23736.25	4	-1820	-0.10%	0 days 01:35:00
2025-09-09 05:50	2025-09-09 12:35	買/賣	23835.75 / 23849.50	4	1100	0.06%	0 days 06:45:00
2025-09-10 01:25	2025-09-10 09:30	買/賣	23897 / 23889	4	-640	-0.03%	0 days 08:05:00
2025-09-15 18:55	2025-09-16 13:30	買/賣	24270.75 / 24326.25	4	4440	0.23%	0 days 18:35:00
2025-09-17 04:35	2025-09-17 08:35	買/賣	24519.25 / 24487	4	-2580	-0.13%	0 days 04:00:00
2025-09-19 15:50	2025-09-22 06:10	買/賣	24764.75 / 24829.75	4	5200	0.26%	2 days 14:20:00
2025-09-22 23:00	2025-09-23 04:55	買/賣	24992.75 / 24987.75	4	-400	-0.02%	0 days 05:55:00
</details>

最佳參數: {'ma_short': 23, 'ma_long': 128, 'stop_loss_usd': 445, 'max_lots': 7}
